# 实验

## 0924

### √1. 标定LED

使用银镜，使用强度最高的LED

1. 寻找该曝光时间：

   以**最亮的光占空比100%** 恰好过曝为光谱仪曝光时间

![image-20240924160958104](C:\Users\z1002\AppData\Roaming\Typora\typora-user-images\image-20240924160958104.png)

​	`[13, 1]`	

​	`LED_exp.txt`

2. 标定LED:

   ![image-20240924161115235](C:\Users\z1002\AppData\Roaming\Typora\typora-user-images\image-20240924161115235.png)

   `[13, 100]`

   `LED_std.txt`

### √2. 测量样品

**使用样品**

1. 寻找曝光时间：

   以**最暗的光占空比100%** 恰好过曝为光谱仪曝光时间

​	`[13, 1]`

​	`LED_exp.txt`

1. 测量LED

![image-20240924161115235](C:\Users\z1002\AppData\Roaming\Typora\typora-user-images\image-20240924161115235.png)

​	`	[13, 100]`

​	`LED_std.txt`

### 3. 标定样品：

**样品不动**

1. 依次插入400-700nm（间隔10nm）的滤光片，每更换一次拍摄一次

​	`[31, 1]`

​	`Mono_std.txt`

### Debug

1. 内存泄露了 `√`
2. 增加自适应照明模式，不需要拍那么多张留个2-3张即可`√`
3. 曝光算法会出现800->2200->过曝的问题卡在死循环，需要优化
4. 文件名称应该换种命名，不需要再带日期的前缀`√`
5. 日志文件最好不分家，统一管理
6. 选择RAW16时有几率卡死；更换曝光时有几率卡死√；自动寻找曝光结束时，UI界面可能不更新；full_auto结束时，UI界面可能不更新

## 0925

### matlab设计

#### modules

1. 真值
2. LED标定值
3. LED测试值

### 1. 真值

- gt:[31, 1104, 1608]，真值



1. 白光 + **空气** + **光谱仪**， 得到白光光谱，$x_1,[31, 1]$

   ![image-20240927140547432](C:\Users\z1002\AppData\Roaming\Typora\typora-user-images\image-20240927140547432.png)

2. 白光 + **31个滤光片** + **相机**，得到31张相片

   ![image-20240927140718350](C:\Users\z1002\AppData\Roaming\Typora\typora-user-images\image-20240927140718350.png)

3. 取相片中校徽中的16个区域，这里以一个像素点为例，得到矩阵$x_2, [31，1]$

4. $相机标定的透射率T = \frac{x_2 } {x_1}$ 



### 2. LED标定值

#### 2.1 标定

- led_zero:[1104, 1608]，暗噪声
- led_zero_delta: [1]，暗噪声图像的相对误差

- led_factor: [13, 100] ，占空比-强度系数表，可能需要考虑QE曲线！！！
- 

#### 2.2 测试均匀性

- led_delta [13, 1]
- source_delta: [1]



### 3. LED测试值

- led_adapt: [13, 1104, 1608]，测试值
- led_adapt_value: [13, 1]，使用到的value
- A:[13, 31],真正的光谱



### 杂

- 均匀性比较

  - 去除暗噪声前

    ![image-20240926145807994](C:\Users\z1002\AppData\Roaming\Typora\typora-user-images\image-20240926145807994.png)

  - 去除暗噪声后

    ![image-20240926161427059](C:\Users\z1002\AppData\Roaming\Typora\typora-user-images\image-20240926161427059.png)

  - 去除噪声后（非平均值）

    ![image-20240926161754642](C:\Users\z1002\AppData\Roaming\Typora\typora-user-images\image-20240926161754642.png)

## 1002

**已知：相机采集的探测值是比较精确的**

### x

- 白光 + 滤光片 + 光谱仪，某一点
- 白光 + 滤光片 + 相机

1. 固定校徽位置，固定曝光恰好白光过曝
2. 白光 + 样本 + 相机
3. 白光 + 样本 + 滤光片 + 相机

#### 滤光片透射率

[31, 301]，行：31个滤光片；纵：301个光谱通道

1. 固定空气位置
2. 白光 + 空气 + 光谱仪
3. 白光 + 空气 + 滤光片 + 光谱仪

对比测试

1. 固定空气位置
2. 白光 + 空气 + 相机
3. 白光 + 空气 + 滤光片 + 相机

