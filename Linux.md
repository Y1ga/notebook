# Linux文件系统

一切被操作系统管理的资源，如网络接口卡、磁盘驱动器、打印机、输入输出设备、普通文件或目录等，都被视为**文件**

## block

- 磁盘的**最小存储单位是扇区(Sector)**，**块(block)由多个扇区组成**，一般**1个block=8个sectors(8 * 512 bytes = 4KB)**

- 文件被存储在若干个blocks中，则需要一个空间来存储文件的**metadata**，即**某个文件被分成几块(blocks)**、每一块所在的地址、文件拥有者、创建时间、权限、大小等信息

## inode

维护**某个文件被分成几块(blocks)**、每一块所在的地址、文件拥有者、创建时间、权限、大小等信息

1. **index + node：索引节点**，每个文件都有一个**唯一**的inode用于存储文件的**元信息(meta-data)**

2. inode数据结构**大小固定**，文件系统创建时就确定，在文件生命周期保持不变

3. inode访问速度**非常快**，系统直接通过inode定位到文件的meta-data，**无需遍历整个文件系统**

4. 每个文件系统的inode**数量有限**，inode用完即使磁盘还有剩余也无法再创建新的文件或目录

5. stat命令查看文件inode号、文件拥有者、创建时间、权限、大小等信息

   ![image-20240806221401276](C:\Users\z1002\AppData\Roaming\Typora\typora-user-images\image-20240806221401276.png)



Linux/Unix 操作系统使用 inode 区分不同的文件。这样做的好处是，即使**文件名被修改或删除，文件的 inode 号码不会改变**，从而可以避免一些因文件重命名、移动或删除导致的错误

## Linux文件

### Linux文件类型

- **普通文件（-）**：用于存储信息和数据， Linux 用户可以根据访问权限对普通文件进行查看、更改和删除。比如：图片、声音、PDF、text、视频、源代码等等。
- **目录文件（d，directory file）**：目录也是文件的一种，用于表示和管理系统中的文件，目录文件中包含一些文件名和子目录名。打开目录事实上就是打开目录文件。
- **符号链接文件（l，symbolic link）**：保留了指向文件的地址而不是文件本身。
- **字符设备（c，char）**：用来访问字符设备比如键盘。
- **设备文件（b，block）**：用来访问块设备比如硬盘、软盘。
- **管道文件(p，pipe)** : 一种特殊类型的文件，用于进程之间的通信。
- **套接字文件(s，socket)**：用于进程间的网络通信，也可以用于本机之间的非网络通信。

![image-20240806222255226](C:\Users\z1002\AppData\Roaming\Typora\typora-user-images\image-20240806222255226.png)

### Linux文件权限

- r(readable)：可读，二进制100即4
- w(writeable)：可写，二进制010即2
- x(executable)：可执行，二进制001即1

![image-20240806222453483](C:\Users\z1002\AppData\Roaming\Typora\typora-user-images\image-20240806222453483.png)

- 对于文件：**cat查看**文件内容/**CRUD**文件内容/**运行二进制文件**

- 对于目录：**查看**目录下列表/**创建删除**目录下文件/使用**cd**进入目录

#### ugo

![image-20240806222655307](C:\Users\z1002\AppData\Roaming\Typora\typora-user-images\image-20240806222655307.png)

- u：**所有者，文件创建者**
- g：文件所在组，即该**用户所在的组**
- o：其他组，除了所有者和所在组的用户外，**系统的其他用户**

#### chmod：更改权限

修改文件所有者全部权限

```shell
chmod u=rwx,g=wx,o=r aaa.txt 
# 或者二进制
chmod 764 aaa.txt
```

**补充一个比较常用的东西:**

假如我们装了一个 zookeeper，我们每次开机到要求其自动启动该怎么办？

1. 新建一个脚本 zookeeper
2. 为新建的脚本 zookeeper 添加可执行权限，命令是:`chmod +x zookeeper`
3. 把 zookeeper 这个脚本添加到开机启动项里面，命令是：`chkconfig --add zookeeper`
4. 如果想看看是否添加成功，命令是：`chkconfig --list`





### Linux文件链接

#### 硬链接(Hard Link)

命令: ln

1. 已知每个文件和**目录**都有**相同且唯一的inode号**，hard link通过inode号建立连接，hard link和源文件的inode相同，对文件系统而言两者平等（**互为hard link，源头是同一份文件**），**删除其中一个对另一个没有影响**，通过给文件设置hard link防止误删
2. 只有**删除源文件和对应的所有hard link文件**，才会被真正删除
3. **不能对不存在的文件和目录创建hard link，因为每个文件系统都有自己的独立inode表，因此无法跨文件系统**，跨文件系统会导致inode节点号冲突，即目标文件的inode节点号已经在该文件系统被使用



#### 软链接(Symbolic Link或Symlink)

命令：ln-s

1. symlink与源文件**inode不同**，但**指向同一个文件路径**
2. 源文件删除后，**symlink仍存在，但指向无效的文件路径**
3. 可以理解为Windows的**快捷方式**
4. **可以对不存在的文件和目录symlink，也可以跨文件系统**





## Linux目录树

![image-20240806223913338](C:\Users\z1002\AppData\Roaming\Typora\typora-user-images\image-20240806223913338.png)

- **/bin：** 存放二进制可执行文件(ls、cat、mkdir 等)，常用命令一般都在这里；
- **/etc：** 存放系统管理和配置文件；
- **/home：** 存放所有用户文件的根目录，是用户主目录的基点，比如用户 user 的主目录就是/home/user，可以用~user 表示；
- **/usr：** 用于存放系统应用程序；
- **/opt：** 额外安装的可选应用程序包所放置的位置。一般情况下，我们可以把 tomcat 等都安装到这里；
- **/proc：** 虚拟文件系统目录，是系统内存的映射。可直接访问这个目录来获取系统信息；
- **/root：** 超级用户（系统管理员）的主目录（特权阶级^o^）；
- **/sbin:** 存放二进制可执行文件，只有 root 才能访问。这里存放的是系统管理员使用的系统级别的管理命令和程序。如 ifconfig 等；
- **/dev：** 用于存放设备文件；
- **/mnt：** 系统管理员安装临时文件系统的安装点，系统提供这个目录是让用户临时挂载其他的文件系统；
- **/boot：** 存放用于系统引导时使用的各种文件；
- **/lib 和/lib64：** 存放着和系统运行相关的库文件 ；
- **/tmp：** 用于存放各种临时文件，是公用的临时文件存储点；
- **/var：** 用于存放运行时需要改变数据的文件，也是某些大文件的溢出区，比方说各种服务的日志文件（系统启动日志等。）等；
- **/lost+found：** 这个目录平时是空的，系统非正常关机而留下“无家可归”的文件（windows 下叫什么.chk）就在这里。



## Linux常用指令



## 其他

- readlink：查看namespace的inode number

- unshare：在新创建的namespace中运行指定的程序（新创建的namespace，新进程）
- nsenter：在指定的进程所在的namespace中运行新的程序（已存在的namespace，新进程）
- pstree：显示进程树
- pstree -pl：显示进程树（含进程号）
-  readlink /proc/$$/ns/{uts,mnt}：查看uts和mnt
- hostname namespace-01 && exec bash：修改hostname并使用**新bash取代当前bas**h使hostname生效
- unshare --net --uts bash：**启动一个新的 bash shell**，它运行在一个**具有网络和 UTS 隔离的环境**中



- cd ..：返回上级
- cd **/**：切换到**系统根目录**
- cd **~**：切换到**用户主目录**
- cd **-**：切换到**上一个操作**所在目录





### 目录操作

- `ls`：显示目录中的文件和子目录的列表。例如：`ls /home`，显示 `/home` 目录下的文件和子目录列表。
- `ll`：`ll` 是 `ls -l` 的别名，ll 命令可以看到该目录下的所有目录和文件的详细信息
- `mkdir [选项] 目录名`：创建新目录（增）。例如：`mkdir -m 755 my_directory`，创建一个名为 `my_directory` 的新目录，并将其权限设置为 755，即所有用户对该目录有读、写和执行的权限。
- `find [路径] [表达式]`：在指定目录及其子目录中搜索文件或目录（查），非常强大灵活。例如：① 列出当前目录及子目录下所有文件和文件夹: `find .`；② 在`/home`目录下查找以 `.txt` 结尾的文件名:`find /home -name "*.txt"` ,忽略大小写: `find /home -i name "*.txt"` ；③ 当前目录及子目录下查找所有以 `.txt` 和 `.pdf` 结尾的文件:`find . \( -name "*.txt" -o -name "*.pdf" \)`或`find . -name "*.txt" -o -name "*.pdf"`。
- `pwd`：显示当前工作目录的路径。
- `rmdir [选项] 目录名`：删除空目录（删）。例如：`rmdir -p my_directory`，删除名为 `my_directory` 的空目录，并且会递归删除`my_directory`的空父目录，直到遇到非空目录或根目录。

- `rm [选项] 文件或目录名`：删除文件/目录（删）。例如：`rm -r my_directory`，删除名为 `my_directory` 的目录，`-r`(recursive,递归) 表示会递归删除指定目录及其所有子目录和文件。
- `cp [选项] 源文件/目录 目标文件/目录`：复制文件或目录（移）。例如：`cp file.txt /home/file.txt`，将 `file.txt` 文件复制到 `/home` 目录下，并重命名为 `file.txt`。`cp -r source destination`，将 `source` 目录及其下的所有子目录和文件复制到 `destination` 目录下，并保留源文件的属性和目录结构。
- `mv [选项] 源文件/目录 目标文件/目录`：移动文件或目录（移），也可以用于重命名文件或目录。例如：`mv file.txt /home/file.txt`，将 `file.txt` 文件移动到 `/home` 目录下，并重命名为 `file.txt`。`mv` 与 `cp` 的结果不同，`mv` 好像文件“搬家”，文件个数并未增加。而 `cp` 对文件进行复制，文件个数增加了。



### 文件操作

像 `mv`、`cp`、`rm` 等文件和目录都适用的命令，这里就不重复列举了。

- `touch [选项] 文件名..`：创建新文件或更新已存在文件（增）。例如：`touch file1.txt file2.txt file3.txt` ，创建 3 个文件。
- `ln [选项] <源文件> <硬链接/软链接文件>`：创建硬链接/软链接。例如：`ln -s file.txt file_link`，创建名为 `file_link` 的软链接，指向 `file.txt` 文件。`-s` 选项代表的就是创建软链接，s 即 symbolic（软链接又名符号链接） 。
- `cat/more/less/tail 文件名`：文件的查看（查） 。命令 `tail -f 文件` 可以对某个文件进行动态监控，例如 Tomcat 的日志文件， 会随着程序的运行，日志会变化，可以使用 `tail -f catalina-2016-11-11.log` 监控 文 件的变化 。
- `vim 文件名`：修改文件的内容（改）。vim 编辑器是 Linux 中的强大组件，是 vi 编辑器的加强版，vim 编辑器的命令和快捷方式有很多，但此处不一一阐述，大家也无需研究的很透彻，使用 vim 编辑修改文件的方式基本会使用就可以了。在实际开发中，使用 vim 编辑器主要作用就是修改配置文件，下面是一般步骤：`vim 文件------>进入文件----->命令模式------>按i进入编辑模式----->编辑文件 ------->按Esc进入底行模式----->输入：wq/q!` （输入 wq 代表写入内容并退出，即保存；输入 q!代表强制退出不保存）。



### 文件压缩

#### 打包+压缩

打包以tar结尾，压缩以gz结尾，因此文件后缀为.tar.gz

```bash
tar -zcvf 打包压缩后的名字 要打包压缩的文件
```

- z：调用**gzip**压缩指令
- c：打包文件
- v：显示运行过程
- f：指定文件名

```bash
# 假设aaa.txt bbb.txt ccc.txt均在/test/文件夹下
tar -zcvf test.tar.gz aaa.txt bbb.txt ccc.txt
# 或者
tar -zcvf test.tar.gz /test/
```

#### 解压

```bash
tar [-xvf] 待解压文件
```

- x：解压

```shell
tar -xvf test.tar.gz
# -C 表示解压的位置
tar -xvf test.tar.gz  -C /usr
```



### 文件传输

- `scp [选项] 源文件 远程文件` （scp 即 secure copy，安全复制）：用于通过 SSH 协议进行安全的文件传输，可以实现从本地到远程主机的上传和从远程主机到本地的下载。例如：`scp -r my_directory user@remote:/home/user` ，将本地目录`my_directory`上传到远程服务器 `/home/user` 目录下。`scp -r user@remote:/home/user/my_directory` ，将远程服务器的 `/home/user` 目录下的`my_directory`目录下载到本地。需要注意的是，`scp` 命令需要在本地和远程系统之间建立 SSH 连接进行文件传输，因此需要确保远程服务器已经配置了 SSH 服务，并且具有正确的权限和认证方式。
- `rsync [选项] 源文件 远程文件` : 可以在本地和远程系统之间高效地进行文件复制，并且能够智能地处理增量复制，节省带宽和时间。例如：`rsync -r my_directory user@remote:/home/user`，将本地目录`my_directory`上传到远程服务器 `/home/user` 目录下。
- `ftp` (File Transfer Protocol)：提供了一种简单的方式来连接到远程 FTP 服务器并进行文件上传、下载、删除等操作。使用之前需要先连接登录远程 FTP 服务器，进入 FTP 命令行界面后，可以使用 `put` 命令将本地文件上传到远程主机，可以使用`get`命令将远程主机的文件下载到本地，可以使用 `delete` 命令删除远程主机的文件。这里就不进行演示了。



# 其他未看



### Linux环境变量

- 用户级别环境变量：~/ .bashrc 、~/.bash_profile
- 系统级别环境变量：/etc/bashrc、/etc/environment、/etc/profile、/etc/profile.d
- 优先级：/etc/environment -> /etc/profile -> /etc/profile.d -> ~/.bash_profile -> /etc/bashrc -> ~/.bashrc

建议：用户级别在~/.bash_profile中配置；系统级别在/etc/profile.d中配置



按照生命周期来分，环境变量可以简单的分成:

- 永久的：使用**vim命令**，需要用户修改相关的配置文件，变量永久生效。
- 临时的：用户利用 **export 命令**，在当前终端下声明环境变量，关闭 shell 终端失效。

#### 读取环境变量

通过 `export` 命令可以输出当前系统定义的所有环境变量。

```bash
# 列出当前的环境变量值
export -p
```

除了 `export` 命令之外， `env` 命令也可以列出所有环境变量。

`echo` 命令可以输出指定环境变量的值。

```bash
# 输出当前的PATH环境变量的值
echo $PATH
# 输出当前的HOME环境变量的值
echo $HOME
```

#### 环境变量修改

通过 `export`命令可以修改指定的环境变量。不过，**这种方式修改环境变量仅仅对当前 shell 终端生效，关闭 shell 终端就会失效**。修改完成之后，立即生效。

```bash
export CLASSPATH=./JAVA_HOME/lib;$JAVA_HOME/jre/lib
```

通过 `vim` 命令修改环境变量配置文件。这种方式修改环境变量**永久有效**。

```bash
vim ~/.bash_profile
```

如果修改的是**系统级别环境变量则对所有用户**生效，如果修改的是**用户级别环境变量则仅对当前用户**生效。

修改完成之后，**需要 `source` 命令让其生效或者关闭 shell 终端重新登录。**

```bash
source /etc/profile
```

# 

### Linux用户组

Linux 系统是一个多用户多任务的分时操作系统，任何一个要使用系统资源的用户，都必须首先向系统管理员申请一个账号，然后以这个账号的身份进入系统。

#### 相关命令

- `useradd [选项] 用户名`:创建用户账号。使用`useradd`指令所建立的帐号，实际上是保存在 `/etc/passwd`文本文件中。
- `userdel [选项] 用户名`:删除用户帐号。
- `usermod [选项] 用户名`:修改用户账号的属性和配置比如用户名、用户 ID、家目录。
- `passwd [选项] 用户名`: 设置用户的认证信息，包括用户密码、密码过期时间等。。例如：`passwd -S 用户名` ，显示用户账号密码信息。`passwd -d 用户名`: 清除用户密码，会导致用户无法登录。`passwd 用户名`，修改用户密码，随后系统会提示输入新密码并确认密码。
- `su [选项] 用户名`（su 即 Switch User，切换用户）：在当前登录的用户和其他用户之间切换身份。

------

#### 用户组管理

每个用户都有一个用户组，系统可以对一个用户组中的所有用户进行集中管理。不同 Linux 系统对用户组的规定有所不同，如 Linux 下的用户属于与它同名的用户组，这个用户组在创建用户时同时创建。

用户组的管理涉及用户组的添加、删除和修改。组的增加、删除和修改实际上就是对`/etc/group`文件的更新。

**Linux 系统用户组的管理相关命令:**

- `groupadd [选项] 用户组` :增加一个新的用户组。
- `groupdel 用户组`:要删除一个已有的用户组。
- `groupmod [选项] 用户组` : 修改用户组的属性。



### 系统状态

- `top [选项]`：用于实时查看系统的 CPU 使用率、内存使用率、进程信息等。
- `htop [选项]`：类似于 `top`，但提供了更加交互式和友好的界面，可让用户交互式操作，支持颜色主题，可横向或纵向滚动浏览进程列表，并支持鼠标操作。
- `uptime [选项]`：用于查看系统总共运行了多长时间、系统的平均负载等信息。
- `vmstat [间隔时间] [重复次数]`：vmstat （Virtual Memory Statistics） 的含义为显示虚拟内存状态，但是它可以报告关于进程、内存、I/O 等系统整体运行状态。
- `free [选项]`：用于查看系统的内存使用情况，包括已用内存、可用内存、缓冲区和缓存等。
- `df [选项] [文件系统]`：用于查看系统的磁盘空间使用情况，包括磁盘空间的总量、已使用量和可用量等，可以指定文件系统上。例如：`df -a`，查看全部文件系统。
- `du [选项] [文件]`：用于查看指定目录或文件的磁盘空间使用情况，可以指定不同的选项来控制输出格式和单位。
- `sar [选项] [时间间隔] [重复次数]`：用于收集、报告和分析系统的性能统计信息，包括系统的 CPU 使用、内存使用、磁盘 I/O、网络活动等详细信息。它的特点是可以连续对系统取样，获得大量的取样数据。取样数据和分析的结果都可以存入文件，使用它时消耗的系统资源很小。
- `ps [选项]`：用于查看系统中的进程信息，包括进程的 ID、状态、资源使用情况等。`ps -ef`/`ps -aux`：这两个命令都是查看当前系统正在运行进程，两者的区别是展示格式不同。如果想要查看特定的进程可以使用这样的格式：`ps aux|grep redis` （查看包括 redis 字符串的进程），也可使用 `pgrep redis -a`。
- `systemctl [命令] [服务名称]`：用于管理系统的服务和单元，可以查看系统服务的状态、启动、停止、重启等。



### 网络通信

- `ping [选项] 目标主机`：测试与目标主机的网络连接。
- `ifconfig` 或 `ip`：用于查看系统的网络接口信息，包括网络接口的 IP 地址、MAC 地址、状态等。
- `netstat [选项]`：用于查看系统的网络连接状态和网络统计信息，可以查看当前的网络连接情况、监听端口、网络协议等。
- `ss [选项]`：比 `netstat` 更好用，提供了更快速、更详细的网络连接信息。

### 其他

- `sudo + 其他命令`：以系统管理者的身份执行指令，也就是说，经由 sudo 所执行的指令就好像是 root 亲自执行。
- `grep 要搜索的字符串 要搜索的文件 --color`：搜索命令，--color 代表高亮显示。
- `kill -9 进程的pid`：杀死进程（-9 表示强制终止）先用 ps 查找进程，然后用 kill 杀掉。
- `shutdown`：`shutdown -h now`：指定现在立即关机；`shutdown +5 "System will shutdown after 5 minutes"`：指定 5 分钟后关机，同时送出警告信息给登入用户。
- `reboot`：`reboot`：重开机。`reboot -w`：做个重开机的模拟（只有纪录并不会真的重开机）。